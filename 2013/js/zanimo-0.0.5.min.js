var Zanimo=function(){if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var d=function(a){var b=/(\(.+?\))/g,d=/^0px$/g;_space=/ /g;_normRegex=/\-([a-z])/g;_emptyString="";_transitionend="transitionend";_transition="transition";_dummy=_prefix=null;_dummyTransition="opacity 100ms linear 0s";_repr=
function(a,b,d){return a+" "+b+"ms "+(d||"linear")};_prefixed={transform:""};_normReplacef=function(a,b){return b.toUpperCase()};_normTransf=function(a){var b=[];a.substr(1,a.length-2).split(",").forEach(function(a){b.push(a.replace(_space,_emptyString).replace(d,"0"))});return"("+b.join(",")+")"};_norm=function(a){return(a[0]==="-"?a.substr(1,a.length-1):a).replace(_normRegex,_normReplacef)};_normTransform=function(a){return isNaN(a)?a.replace(b,_normTransf):""+a};"WebkitTransition"in a.body.style&&
(_transitionend="webkitTransitionEnd",_prefix="webkit");for(var e in _prefixed)_prefixed[e]=_prefix?"-"+_prefix+"-"+e:e;_transition=_prefix?_prefix+"-"+_transition:_transition;_transition=_norm(_transition);_dummy=a.createElement("div");_dummyTransition=_normTransform(_dummyTransition);_dummy.style[_transition]=_dummyTransition;_dummy=_normTransform(_dummy.style[_transition]);_dummy===_dummyTransition&&(_repr=function(a,b,d){return a+" "+b+"ms "+(d||"linear")+" 0s"});return{t:_transition,transform:_norm(_prefixed.transform),
transitionend:_transitionend,norm:_norm,prefix:function(a){return _prefixed[a]?_prefixed[a]:a},repr:_repr,normTransform:_normTransform}}(window.document),c=function(a){return a instanceof HTMLElement?Q.resolve(a):Q.isPromise(a)?a.then(c):Q.reject(Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))},i=function(a,b,g,e,c){b=d.prefix(b);a.style[d.t]=a.style[d.t]?a.style[d.t]+", "+d.repr(b,e,c):d.repr(b,e,c);a.style[d.norm(b)]=g};c.transition=function(a,b,g,e,c){var f=Q.defer(),h,
j=function(e){h&&(clearTimeout(h),h=null);d.prefix(b);var c=Object.keys(a._zanimo);c.length===1&&c[0]===b&&(a.style[d.t]="");a.removeEventListener(d.transitionend,k);e&&delete a._zanimo[b]},k=function(c){c.propertyName===d.norm(b)&&(j(!0),f.resolve(a))};if(!(a instanceof HTMLElement))return f.reject(Error("Zanimo transition: no DOM element!")),f.promise;if(window.isNaN(parseInt(e,10)))return f.reject(Error("Zanimo transition: duration must be an integer!")),f.promise;a.addEventListener(d.transitionend,
k);window.requestAnimationFrame(function(){i(a,b,g,e,c);h=setTimeout(function(){var c=a.style.getPropertyValue(d.prefix(b)),c=d.normTransform(c),e=d.normTransform(g);j(!0);c===e?f.resolve(a):f.reject(Error("Zanimo transition: "+a.id+" with "+b+" = "+e+", DOM value="+c))},e+20);a._zanimo=a._zanimo||{};a._zanimo[b]&&(a._zanimo[b].defer.reject(Error("Zanimo transition "+a.id+" with "+b+"="+a._zanimo[b].value+" stopped by transition with "+b+"="+g)),a._zanimo[b].cb());a._zanimo[b]={cb:j,value:g,defer:f}},
a);return f.promise};c.transitionf=function(a,b,d,e){return function(i){return c.transition(i,a,b,d,e)}};c.transform=function(a,b,c){var e=Q.defer();if(!(a instanceof HTMLElement))return e.reject(Error("Zanimo transform: no DOM element!")),e.promise;a._zanimo&&a._zanimo.hasOwnProperty("transform")&&(a._zanimo.transform.defer.reject(Error("Zanimo transition "+a.id+" with transform="+a._zanimo.transform.value+" stopped by transform="+b)),a._zanimo.transform.cb());window.requestAnimationFrame(function(){a.style[d.transform]=
!c?a.style[d.transform]+" "+b:b;e.resolve(a)},a);return e.promise};c.transformf=function(a,b){return function(d){return c.transform(d,a,b)}};c.f=function(a){return function(){return c(a)}};c.all=function(a){return function(b){return Q.all(a.map(function(a){return a(b)})).then(function(){return b},function(a){throw a;})}};c._T=d;return c}();
